<form name="form" method="post" ng-submit="vm.saveRecipe()">
  <legend>
    <h1>{{vm.title}}</h1>
  </legend>
  <div class="row">
    <div class="col-md-5 well">

      <div class="form-group">
        <fieldset flow-init="{
                    target: '/api/user/upload',
                    headers: {
                      'x-access-token': vm.idToken,
                    },
                    singleFile: true,
                    fileParameterName: 'photo',
                    uploadMethod: 'POST',
                    testChunks: false,
                  }"
                  flow-files-submitted="$flow.upload()"
                  flow-file-success="vm.onPictureUpload($file, $message, $flow)">

          <!-- Thumbnail Preview -->
          <div class="text-center">
            <figure class="img-thumbnail">
              <div class="recipe__thumbnail-wrap">
                <img class="recipe__thumbnail"
                     ng-hide="$flow.files.length"
                     ng-src="{{vm.getThumbnail()}}" />
                <img class="recipe__thumbnail"
                     ng-show="$flow.files.length"
                     flow-img="$flow.files[0]" />
              </div>
            </figure>
          </div>

          <br />

          <!-- Thumbnail -->
          <div class="form-group">
            <label for="thumbnail">Photo</label>
            <div class="input-group">
              <span class="input-group-addon">File</span>
              <input class="form-control input-lg"
                     type="text"
                     name="thumbnail"
                     flow-btn flow-attrs="{accept:'image/*'}"
                     flow-drop
                     ng-model="vm.recipe.thumbnail"
                     placeholder="Drop here or click to select file"
                     readonly />
            </div>
          </div>

        </fieldset>
      </div>
    </div>

    <div class="col-md-7">
      <fieldset>

        <!-- Title (required) -->
        <div class="form-group">
          <label for="title">Title</label>
          <input class="form-control input-lg"
                 type="text"
                 name="title"
                 ng-model="vm.recipe.title"
                 placeholder="Title"
                 required autofocus />
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description">Description</label>
          <textarea class="form-control input-lg"
                 type="text"
                 name="description"
                 ng-model="vm.recipe.description"
                 placeholder="Description"></textarea>
        </div>

        <div class="row">
          <div class="col-md-7">

            <!-- Category -->
            <!-- TODO: Autocomplete with existing categories -->
            <div class="form-group">
              <label for="category">Category</label>
              <input class="form-control input-lg"
                     type="text"
                     name="category"
                     ng-model="vm.recipe.category.label"
                     ng-change="vm.generateCategorySlug()"
                     placeholder="Category" />
            </div>

          </div>
          <div class="col-md-5">

            <!-- Rating -->
            <div class="form-group">
              <label>Rating</label>
              <span class="form-control input-lg">Select:&nbsp;
              <rating ng-model="vm.recipe.rating"
                      max="{{vm.rating.max}}"></rating></span>
            </div>

          </div>
        </div>

        <div class="row">
          <div class="col-md-4">

            <!-- Prep Time -->
            <div class="form-group">
              <label for="prep_time">Prep Time</label>
              <div class="input-group">
                <input class="form-control"
                       type="number"
                       name="prep_time"
                       step="any"
                       min="1"
                       ng-model="vm.recipe.prep_time" />
                <span class="input-group-addon">minutes</span>
              </div>
            </div>

          </div>
          <div class="col-md-4">

            <!-- Cook Time -->
            <div class="form-group">
              <label for="prep_time">Cook Time</label>
              <div class="input-group">
                <input class="form-control"
                       type="number"
                       name="cook_time"
                       step="any"
                       min="1"
                       ng-model="vm.recipe.cook_time" />
                <span class="input-group-addon">minutes</span>
              </div>
            </div>

          </div>
          <div class="col-md-4">

            <!-- Servings -->
            <div class="form-group">
              <label for="prep_time">Servings</label>
              <input class="form-control"
                     type="number"
                     name="yield_qty"
                     min="1"
                     step="1"
                     ng-model="vm.recipe.yield_qty" />
            </div>

          </div>
        </div>
      </fieldset>
    </div>
  </div>

  <br />

  <div class="row">
    <div class="col-md-5">
      <fieldset>
        <legend>
          <h3>Ingredients <small>Drag to reorder</small></h3>
        </legend>

        <!-- Ingredients -->
        <ol class="list-group"
            sv-root
            sv-part="vm.recipe.ingredients"
            sv-on-sort="vm.onIngredientReorder()">
          <li class="list-group-item list-group-item-custom clearfix"
              ng-repeat="ingredient in vm.recipe.ingredients
                          | orderBy: 'order'"
              ng-init="format = 'inline'"
              sv-element="{ containment: '[sv-root]' }">

            <!-- Ingredient order and drag handle -->
            <span class="drag-handle list-group-addon list-group-addon--left"
                  sv-handle>
              <i class="glyphicon glyphicon-resize-vertical text-muted"></i>
            </span>

            <span class="list-group-addon list-group-addon--right pull-right">
              <div class="btn-group">
                <button class="btn btn-sm"
                        ng-class="{
                          'btn-default': (format === 'inline'),
                          'btn-success': (format === 'form')
                        }"
                        type="button"
                        ng-click="format === 'inline' ? format = 'form' : format = 'inline'">
                  <span>{{format === 'inline' ? 'Edit' : 'OK'}}</span>
                </button>
                <button class="btn btn-sm btn-danger"
                        type="button"
                        ng-click="vm.removeIngredient(ingredient)"
                        aria-label="remove">
                  <i class="glyphicon glyphicon-remove"></i>
                </button>
              </div>
            </span>

            <!-- Ingredient -->
            <span class="list-group-text">
              <strong class="ingredient__qty" ng-bind="ingredient.qty"></strong> <strong class="ingredient__measure" ng-bind="ingredient.measure"></strong> <span class="ingredient__name" ng-bind="ingredient.name"></span>{{ingredient.preparation ? ', ' : ''}}<em class="ingredient__preparation" ng-bind="ingredient.preparation"></em>
            </span>

            <div class="well well-sm"
                 ng-show="format === 'form'">
              <div class="form-group">
                  <!-- Qty -->
                  <input class="form-control"
                         style="width: 35%;"
                         type="number"
                         name="qty"
                         step="any"
                         min="0.1"
                         ng-model="ingredient.qty"
                         placeholder="Quantity" />

                  <!-- Measure -->
                  <input class="form-control"
                         style="width: 65%;"
                         type="text"
                         name="measure"
                         ng-model="ingredient.measure"
                         placeholder="Measure" />
              </div>

              <div class="form-group">
                <!-- Name (required) -->
                <input class="form-control input-sm"
                       type="text"
                       name="name"
                       ng-model="ingredient.name"
                       placeholder="Ingredient"
                       required />
              </div>

              <div class="form-group">
                <!-- Preparation -->
                <input class="form-control input-sm"
                       type="text"
                       name="preparation"
                       ng-model="ingredient.preparation"
                       placeholder="Preparation" />
              </div>
            </div>
          </li>
          <li class="list-group-item clearfix">
            <!-- Add ingredient -->
            <button class="btn btn-default btn-block"
                    type="button"
                    ng-click="vm.addIngredient()">
              <i class="glyphicon glyphicon-plus" aria-hidden="true"></i>
              <span> Add Ingredient</span>
            </button>
          </li>
        </ol>
      </fieldset>
    </div>

    <div class="col-md-7">
      <fieldset>
        <legend>
          <h3>Directions <small>Drag to reorder</small></h3>
        </legend>

        <!-- Steps -->
        <ol class="list-unstyled"
            sv-root
            sv-part="vm.recipe.steps"
            sv-on-sort="vm.onStepReorder()">
          <li class="panel panel-default"
               ng-repeat="step in vm.recipe.steps
                          | orderBy: 'order'"
               sv-element="{ containment: '[sv-root]' }">
            <div class="panel-body row">
              <rt-step step="step"
                       format="form"
                       on-remove="vm.removeStep(step)">
              </rt-step>
            </div>
          </li>
        </ol>

        <!-- Add direction step -->
        <button class="btn btn-default btn-lg btn-block"
                type="button"
                ng-click="vm.addStep()">
          <i class="glyphicon glyphicon-plus" aria-hidden="true"></i>
          <span> Add Step</span>
        </button>

      </fieldset>
    </div>
  </div>

  <hr />

  <div class="text-right">

    <!-- Submit -->
    <button class="btn btn-success btn-lg"
            type="submit"
            ng-disabled="form.$invalid">
      <i class="glyphicon glyphicon-ok" aria-hidden="true"></i>
      <span> Save</span>
    </button>

    <!-- Cancel -->
    <a class="btn btn-lg btn-warning" ui-sref="^.list">
      <i class="glyphicon glyphicon-remove" aria-hidden="true"></i>
      <span> Cancel</span>
    </a>
  </div>
</form>
